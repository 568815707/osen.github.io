<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="PWA(Progressive Web App)," />





  <link rel="alternate" href="/atom.xml" title="osenki" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="【 PWA 】  今天开始 Research 一个新的前端技术，PWA（ 全称：Progressive Web App ）也就是说这是个渐进式的网页应用程序。这个技术的呢是 Google 公司于2015 年提出的，2016 年 6 月才推广的项目。针对这一项技术目前在国外似乎已经很流行了，目前应用这项技术最火热的应用是在印度（ 大家或许会疑惑为什么是在印度最流行呢吧，下文中会告诉大家哦 ），既然">
<meta name="keywords" content="PWA(Progressive Web App)">
<meta property="og:type" content="article">
<meta property="og:title" content="PWA(Progressive Web App)">
<meta property="og:url" content="osenki.cn/2017/09/09/PWA-Progressive-Web-App/index.html">
<meta property="og:site_name" content="osenki">
<meta property="og:description" content="【 PWA 】  今天开始 Research 一个新的前端技术，PWA（ 全称：Progressive Web App ）也就是说这是个渐进式的网页应用程序。这个技术的呢是 Google 公司于2015 年提出的，2016 年 6 月才推广的项目。针对这一项技术目前在国外似乎已经很流行了，目前应用这项技术最火热的应用是在印度（ 大家或许会疑惑为什么是在印度最流行呢吧，下文中会告诉大家哦 ），既然">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_s0qX_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_VTyB_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_bR5z_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_kB7y_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_U9n4_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_Z4cS_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_lqqQ_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_bBN5_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_nmwE_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_0MDP_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_L9vM_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_oDGM_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_N2eL_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162358_iejq_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_cBdU_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_YyvC_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162358_t95c_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162358_KTLf_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162358_KhRc_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162358_Fckh_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162358_Nj8t_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162359_jR85_3125199.png">
<meta property="og:image" content="https://static.oschina.net/uploads/space/2017/0824/162358_m9Li_3125199.png">
<meta property="og:updated_time" content="2017-09-25T16:57:56.378Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PWA(Progressive Web App)">
<meta name="twitter:description" content="【 PWA 】  今天开始 Research 一个新的前端技术，PWA（ 全称：Progressive Web App ）也就是说这是个渐进式的网页应用程序。这个技术的呢是 Google 公司于2015 年提出的，2016 年 6 月才推广的项目。针对这一项技术目前在国外似乎已经很流行了，目前应用这项技术最火热的应用是在印度（ 大家或许会疑惑为什么是在印度最流行呢吧，下文中会告诉大家哦 ），既然">
<meta name="twitter:image" content="https://static.oschina.net/uploads/space/2017/0824/162357_s0qX_3125199.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.2',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="osenki.cn/2017/09/09/PWA-Progressive-Web-App/"/>





  <title>PWA(Progressive Web App) | osenki</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>
	<a href="https://github.com/568815707/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">osenki</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">胆大，心细，不断努力。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="osenki.cn/2017/09/09/PWA-Progressive-Web-App/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="osenki">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="osenki">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">PWA(Progressive Web App)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T14:18:43+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前瞻技术/" itemprop="url" rel="index">
                    <span itemprop="name">前瞻技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>【 PWA 】</p>
<blockquote>
<p>今天开始 Research 一个新的前端技术，PWA（ 全称：Progressive Web App ）也就是说这是个渐进式的网页应用程序。这个技术的呢是 Google 公司于2015 年提出的，2016 年 6 月才推广的项目。针对这一项技术目前在国外似乎已经很流行了，目前应用这项技术最火热的应用是在印度（ 大家或许会疑惑为什么是在印度最流行呢吧，下文中会告诉大家哦 ），既然 PWA 这项技术在国外已经非常的流行了，那么在国内或许会不远了（ Angular 5 中新增的功能中，重点在于能够更轻松的构建渐进式网络应用程序，也就是 PWA 了。作为Google 和 mozilla 的产物，肯定会越来越重视啦 ）我引用一下关于PWA技术的一篇最早的博客文中的一句话吧： “ escaping tabs without losing our soul “（ 翻译一下哈：逃避选项卡而不丢失我们的灵魂 ）。</p>
</blockquote>
<p>官网上给出 PWA 的宣传是 ： <code>Reliable</code> （ 可靠的 ）、<code>Fast</code>（ 快速的 ）、<code>Engaging</code>（ 可参与的 ）（ 官网：<a href="https://developers.google.com/web/progressive-web-apps/" target="_blank" rel="external">https://developers.google.com/web/progressive-web-apps/</a> ps：需要翻墙哦  ）。简单的说一下这三个特性：</p>
<p> <code>Reliable</code> ： 为什么他是可靠的呢，当用户从手机主屏幕启动时，不用考虑网络的状态是如何，都可以立刻加载出 PWA。<br> <img src="https://static.oschina.net/uploads/space/2017/0824/162357_s0qX_3125199.png" alt="">    </p>
<p> <code>Fast</code>：这一点应该都很熟悉了吧，站在用户的角度来考虑，如果一个网页加载速度有点长的话，那么我们会放弃浏览该网站，所以 PWA 在这一点上做的很好，他的加载速度是很快的。<br> <img src="https://static.oschina.net/uploads/space/2017/0824/162357_VTyB_3125199.png" alt=""></p>
<p> <code>Engaging</code> ： PWA 可以添加在用户的主屏幕上，不用从应用商店进行下载（ 似乎省了下载流量哦！）他们通过网络应用程序 <code>Manifest file</code> 提供类似于 APP 的使用体验（ 在 Android 上可以设置全屏显示哦，由于 Safari 支持度的问题，所以在 IOS 上并不可以 ），并且还能进行 ”推送通知” 。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_bR5z_3125199.png" alt=""><br> 这三个主特性似乎能解释我在前言中所说的 ”在印度最流行“ 。小小的普及一下，根据2016年第三季度的 IDC统计数据显示，印度的智能手机的出货量达到了3亿，同时也超过了美国，成为了全球第二大智能手机市场。皮尤斯数据报告 2015 年曾统计过“全球智能手机拥有率”。印度只有 17% 的人口用的是智能手机。虽然绝大部分人有手机用，但为非智能机，另有 22% 的人没有手机。针对印度的移动网络流量来说，网络状况是非常不佳的，根据16年的 GSMA 印度移动经济报告显示，网络覆盖率为34.8% 。主要集中在城镇，印度广大的农村还处于网络盲区，城乡数字化鸿沟很大。在印度，2G/3G 最主流，且 2G 占比还远高于 3G ， 所以针对这种状态来说，PWA 技术最适合不过了。</p>
<p> 在我对 PWA 技术的研究中发现 PWA 其中有三个关键的技术：</p>
<ul>
<li><code>Service Worker</code>（ ps：就叫做服务工厂吧，文章最后一条 URL 是 SW 的全面进阶，可以研究研究哦 ）</li>
<li><code>Manifest</code> （应用清单）</li>
<li><code>Push Notification</code>（推送通知）</li>
</ul>
<blockquote>
<p>下面我一一介绍着三个关键的技术：</p>
</blockquote>
<p><code>Service Worker</code>（ 以下用SW来代替 ） ：</p>
<p>SW 是什么呢？这个是离线缓存文件。我们 PWA 技术使用的就是它！SW 是浏览器在后台独立于网页运行的脚本，它打开了通向不需要网页或用户交互的功能的大门，因为使用了它，才会有的那个 <code>Reliable</code> 特性吧，SW 作用于 浏览器于服务器之间，相当于一个代理服务器（ 用一张图来表示一下他的位置 ）。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_kB7y_3125199.png" alt=""></p>
<p>为什么会用到 SW 呢？原声 App 拥有Web应用通常所不具备的富离线体验，定时默认更新，消息推送等功能，而 SW 标准让在 Web App 上拥有这些功能成为可能！</p>
<p>跟 SW 相同的 API 还有 <code>App Cache</code> ，为什么不使用它呢？ <code>App Cache</code> 是有局限性的，比如说：它很容易得解决 <code>single web page application</code> （ 单页面应用 ）的问题，但是在多页面应用上会很麻烦， SW 解决的这个 <code>App Cache</code>的缺点！</p>
<p> 下面我简单而详细的说一下 SW ：<br> 1、 浏览器支持<br>    目前浏览器的支持度还不是很高。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_U9n4_3125199.png" alt=""></p>
<blockquote>
<p>顺便带一句：目前只能在 HTTPS 环境下才能使用SW，因为SW 的权利比较大，能够直接截取和返回用户的请求，所以要考虑一下安全性问题。</p>
</blockquote>
<p>2、事件机制<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_Z4cS_3125199.png" alt=""><br>3、 功能</p>
<blockquote>
<p>SW的功能还是比较逆天的！</p>
</blockquote>
<ul>
<li>后台数据的同步</li>
<li>从其他域获取资源请求</li>
<li>接受计算密集型数据的更新，多页面共享该数据</li>
<li>客户端编译与依赖管理</li>
<li>后端服务的hook机制</li>
<li>根据URL模式，自定义模板</li>
<li>性能优化</li>
<li>消息推送</li>
<li>定时默认更新</li>
<li>地理围栏</li>
</ul>
<p>4、 生命周期<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_lqqQ_3125199.png" alt=""><br><code>Parsed</code> （ 解析成功 ）： 首次注册 SW 时，浏览器解决脚本并获得入口点，如果解析成功，就可以访问到 SW 注册对象，在这一点中我们需要在 HTML 页面中添加一个判断，判断该浏览器是否支持 SW 。</p>
<p><code>Installing</code> （ 正在安装 ）：SW 脚本解析完成之后，浏览器会尝试进行安装，<code>installing</code> 中 <code>install</code> 事件被执行，如果其中有 <code>event.waitUntil ( )</code>方法，则 <code>installing</code> 事件会一直等到该方法中的 <code>Promise</code> 完成之后才会成功，如果 <code>Promise</code> 被拒绝，则安装失败，SW会进入 <code>Redundant</code>（ 废弃 ）状态。</p>
<p><code>Installed / Waiting</code> （安装成功/等待中）：如果安装成功，SW 将会进入这个状态。</p>
<p><code>Activating</code> （ 正在激活 ）：处于 waiting 状态的 SW 发生以下情况，将会进入 activating 状态中：</p>
<p>当前已无激活状态的 <code>worker</code> 、 SW脚本中的 <code>self.skipWaiting（）</code>方法被调用 （ <em>ps： self 是 SW 中作用于全局的对象，这个方法根据英文翻译过来也能明白什么意思啦，跳过等待状态</em> ）、用户已关闭 SW 作用域下的所有页面，从而释放了当前处于激活状态的 <code>worker</code>、超出指定时间，从而释放当前处于激活状态的 <code>worker</code></p>
<p><code>Activated</code> （ 激活成功 ）：该状态，其成功接收了 <code>document</code> 全面控制的激活态 <code>worker</code> 。</p>
<p><code>Redundant</code> （ 废弃 ）：这个状态的出现时有原因的，如果 <code>installing</code> 事件失败或者 <code>activating</code> 事件失败或者新的 SW 替换其成为激活态 <code>worker</code> 。<code>installing</code> 事件失败和 <code>activating</code> 事件失败的信息我们可以在 <code>Chrome</code> 浏览器的 <code>DevTools</code> 中查看.<br>            （ ps：我这个是正常的状态下的 ，错误的话会有 error 提示的）<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_bBN5_3125199.png" alt=""></p>
<p>5、主要依赖</p>
<p>SW 作为现代浏览器的高级特性，依赖于 <code>fetch</code> 、<code>promise</code> 、<code>CacheStorage</code>、<code>Cache</code>、等浏览器的基础能力， <code>Cache</code> 提供了 <code>Request</code> / <code>Response</code> 对象对的存储机制。<code>CacheStorage</code> 则提供了存储 <code>Cache</code> 对象的机制。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_nmwE_3125199.png" alt="">  </p>
<p>6、安全性问题</p>
<p>跨域请求支持：  SW 可以拦截它作用域内的所有请求，跨域资源也不例外，但是浏览器默认对跨域资源发起的是 <code>no-cors</code> 请求，得到的 <code>response</code> 是 <code>opaque</code> 的， 所以会导致我们无法判断跨域请求是否成功，以便进行缓存，因此我们需要修改 <code>fetch</code> 请求头部信息，添加 <code>mode：’cors’</code> 标记。</p>
<p>（ 名词解释一下喽，这部分知识是关于 <code>fetch API</code> 的，想了解更多的同学，自行搜索相关的知识哈 ）</p>
<p><code>no-cors</code>：该模式允许来自 CDN 的脚本、其他域的图片和其他一些跨域资源，但是首先有个前提条件，就是请求的 <code>method</code> 只能是 <code>HEAD</code> 、<code>GET</code> 、<code>POST</code> 。此外，如果 <code>ServiceWorkers</code> 拦截了这些请求，它不能随意添加或者修改除这些之外 <code>Header</code> 属性。第三，JS 不能访问 <code>Response</code> 对象中的任何属性，这确保了跨域时 <code>ServiceWorkers</code> 的安全和隐私信息泄漏问题。</p>
<p><code>opaque</code>：<code>Response</code> 对象中 <code>type</code> 属性的值 ， 在 <code>no-cors</code> 模式下请求了跨域资源，依靠服务端来做限制。</p>
<blockquote>
<p>Manifest （ 应用清单 ）</p>
</blockquote>
<p>Web App Manifest 是一个 W3C 规范，它定义了一个基于 JSON 的 List 。Manifest 在 PWA 中的作用有：</p>
<ul>
<li>能够将你浏览的网页添加到你的手机屏幕上</li>
<li>在 Android 上能够全屏启动，不显示地址栏 （ 由于 Iphone 手机的浏览器是 Safari ，所以不支持哦）</li>
<li>控制屏幕 横屏 / 竖屏 展示</li>
<li>定义启动画面</li>
<li>可以设置你的应用启动是从主屏幕启动还是从 URL 启动</li>
<li>可以设置你添加屏幕上的应用程序图标、名字、图标大小</li>
<li>Push Notification （ 消息通知 ）</li>
<li>Push 和 Notification 是两个不同的功能，涉及到两个 API 。</li>
<li>Notification 是浏览器发出的通知消息。</li>
<li>Push 和 Notification 的关系，Push：服务器端将更新的信息传递给 SW ，Notification： SW 将更新的信息推送给用户。</li>
</ul>
<p>缺点：</p>
<ul>
<li>浏览器的支持度问题，尤其是 Safari 浏览器，这样就会导致我们在 IOS 系统手机上没办法体验 PWA 。（ 谁让 ‘ 果果 ’ 不是开源的呢 ）</li>
<li>根据国情来看哈，目前 Native App 的使用用户都已经习惯了，虽然会下载一下，但是现在 WiFi 到处都是了，毕竟 WiFi 的普及太快了。让用户使用 PWA 来替代 Native App 短时间会不适应的。</li>
<li>消息推送问题，PWA的消息推送走的是 GCM（ FCM ）通道。而国内 Google 是无法访问的。（只能翻墙了，但是工信部已经禁止使用 VPN 了。）</li>
</ul>
<p>总体来说：</p>
<p>Google 的技术在国内推进比较缓慢，所以 PWA 在国内的发展是有多困难吧。</p>
<p>【 Demo 】<br>首先呢，我们用到有 Node 和 Ngrok 。Node 的使用以及安装我就不说啦，作为一名前端开发工程师肯定会使用的啦。不会使用也米有关系啦，我们有度娘呢，Ngrok 的安装以及使用我就直接共享一个URl吧：<a href="http://blog.csdn.net/tomcat_2014/article/details/68944066（" target="_blank" rel="external">http://blog.csdn.net/tomcat_2014/article/details/68944066（</a> <em>ps：我就偷懒一下</em> ）</p>
<ul>
<li>我们先创建一个关于 PWA 的项目文件夹，</li>
<li>进入文件夹下我们准备一张 120x120的图片一张，作为我们的应用程序图标。</li>
<li>创建一个 index.html  文件</li>
<li>创建一个 index.css 文件</li>
<li>创建一个 manifest.json 文件</li>
<li>创建一个 sw.js 文件</li>
<li>利用终端，安装一下 http-server 服务</li>
</ul>
<p>index.html<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_0MDP_3125199.png" alt=""></p>
<p>index.css<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_L9vM_3125199.png" alt=""></p>
<blockquote>
<p>manifest.json中的一些参数的简单的介绍</p>
</blockquote>
<p>short_name: “ “ 用户主屏幕上的应用名字</p>
<p>display : “standalone”  设置启动样式，让您的网络应用隐藏浏览器的 URL 地址栏</p>
<p>start_url : “/“ 设置启动网址，如果不提供的话，默认是使用当前页面</p>
<p>theme_color : “ “  用来告知浏览器用什么颜色来为地址栏等 UI 元素着色</p>
<p>background_color: “ ” 设置启动页面的背景颜色</p>
<p>icons：””  就是添加到主屏幕之后的图标<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_oDGM_3125199.png" alt=""></p>
<p>sw.js</p>
<p>处理静态缓存，首先定义需要缓存的路径，以及需要缓存的静态文件的列表。</p>
<p>借助 SW 注册完成安装 SW 时，抓取资源写入缓存中。使用了一个方法那就是 <code>self.skipWaiting( )</code> 这个方法我在前边介绍的时候也说了，为了在页面更新的过程当中，新的 SW 脚本能够立刻激活和生效。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_N2eL_3125199.png" alt=""></p>
<p>处理动态缓存，我们监听 <code>fetch 事件</code>，在 <code>caches</code> 中去 <code>match</code> 事件的 <code>request</code> ，如果 <code>response</code> 不为空的话就返回 <code>response</code> ，最后返回 <code>fetch</code> 请求，在 <code>fetch</code> 事件中我们可以手动生成 <code>response</code> 返回给页面。</p>
<p>更新静态资源，缓存的资源会跟随着版本的更新会过期的，所以会根据缓存的字符串名称清除旧缓存。在新安装的 SW 中通过调用 <code>self.clients.claim( )</code> 取得页面的控制权，这样之后打开页面都会使用版本更新的缓存。旧的 SW 脚本不在控制着页面之后会被停止，也就是会进入 <code>Redundant</code> 期。</p>
<p><img src="https://static.oschina.net/uploads/space/2017/0824/162358_iejq_3125199.png" alt=""></p>
<p> 以上截图中最左侧是我文件下的列表喽，下面我们来运行一下，终端启动 http-server 服务，我们以关闭缓存的方式进行启动。<br> <img src="https://static.oschina.net/uploads/space/2017/0824/162357_cBdU_3125199.png" alt=""></p>
<p>接下来我们使用 ngrok 这个工具，进行内网穿透。在上边启动 http-server 服务的时候我们使用默认的端口号 8080 。所以我们在 ngrok 中我们绑定 端口 8080 。输入命令 ： ./ngrok http 8080 之后我们看一下。（记得再打开一个终端哦，在另一个终端中进行操作）<br><img src="https://static.oschina.net/uploads/space/2017/0824/162357_YyvC_3125199.png" alt=""></p>
<p>我们看到绿色的字母 online 表示内网穿透成功了，我们看最后一个 <em>Forwarding     https://</em> 的，因为我们在上边介绍了，SW 的权利比较大，为了保证信息的安全性，我们使用 https 协议来进行访问。我们把它复制下来在 chrom 浏览器中打开，-&gt; 符号后边的就不用复制了哈。（ <em>每个人的 ‘隧道’ 都是不一样的哦，这一点同学们可以在 ngrok 官网中进行查询哦</em> ）。</p>
<p>我们打开 chrom 的调试工具，打开 application ，点击 service workers 之后我们会发现 sw.js 脚本已经存到了 SW 中 。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162358_t95c_3125199.png" alt=""></p>
<p>我们打开 Network 刷新页面一下，看看，我们的页面资源来自 SW 而不是其他的地方，在 Console 中也打印出了我们在 index.html 中判断的语句，浏览器支持就会打印出这一句话哦。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162358_KTLf_3125199.png" alt=""></p>
<p>接下来我们断网操作，在 <code>Application</code> 中给 <code>Offline</code> 打上对勾就行啦。然后刷新页面，我们仍然能看到之前的页面，原因就是我们在上图看到，他的资源是从 SW 上获得到的。当我们第一次打开这个页面的时候，<code>Resopnse</code> 对象被存到了 <code>Cache Storage</code> （ 定义在 SW 规范中 ，相关资料请同学们自行查询啦 ）中。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162358_KhRc_3125199.png" alt=""></p>
<p>通过存放到 <code>Cache Storage</code> 中，我们下次访问的时候如果是弱网或者断网的情况下，就可以不走网络请求，而直接就能将本地缓存的内容展示给用户，优化用户的弱网及断网体验。</p>
<p>这个时候肯定会有同学在想，如果内容更新了，那么页面展示的内容是新内容呢还是旧内容呢？下面我们操作一下，打开 <code>index.html</code> 文件，我们在 <code>body</code> 中添加一个 <code>p</code> 标签 ，然后回到页面刷新。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162358_Fckh_3125199.png" alt=""></p>
<p><img src="https://static.oschina.net/uploads/space/2017/0824/162358_Nj8t_3125199.png" alt=""></p>
<p>我们看到，页面上的内容并没有显示出我刚刚添加的那个 <code>p</code> 标签。这说明了，我们拿到的数据还是从 <code>Cache Storage</code> 中获取到的，<code>Cache Storage</code>中的内容并没有更新，那么我们怎么才能让我刚刚添加的那个 <code>p</code> 标签显示出来呢。</p>
<p>我们打开 sw.js 脚本文件，我们修改一下 cacheStorageKey。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162359_jR85_3125199.png" alt=""></p>
<p>我们关闭一下浏览器，然后再次打开该网址，页面出现了我们刚刚添加的那个 <code>p</code> 标签。我们再看一下 <code>Cache Storage</code> 中的缓存名字，已经被修改。<br><img src="https://static.oschina.net/uploads/space/2017/0824/162358_m9Li_3125199.png" alt=""></p>
<p>【 总结 】</p>
<p>在研究这个 PWA 的过程中，搜索了相关的一大部分知识，就怕自己的脑洞不够大。感觉 PWA 涉及到的 API 比较多。要想研究透彻 PWA 还需要研究它所涉及到的 API ，慢慢研究吧。<code>npm</code> 中已经有这个包了哦。想真实的对 PWA 做深入研究的同学，可以应用到实际项目中。（ 我感觉，会有很多坑 ）</p>

      
    </div>
    
    
    

    

    

    
	<div>
		
		<div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

		
	</div>
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/PWA-Progressive-Web-App/" <i class="fa fa-tag"></i> PWA(Progressive Web App)</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/22/React翻牌抽奖/" rel="prev" title="React翻牌抽奖">
                React翻牌抽奖 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <img class="site-author-image" itemprop="image"
              src="/images/avatar.png"
              alt="osenki" />
          
            <p class="site-author-name" itemprop="name">osenki</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://568815707.github.io/osen.github.io/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:568815707@qq.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://my.oschina.net/Osen/blog" target="_blank" title="开源中国">
                  
                    <i class="fa fa-fw fa-globe"></i>开源中国</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/qq_19238139" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-globe"></i>CSDN</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://juejin.im/user/59a3e4dff265da2480335161" target="_blank" title="掘金">
                  
                    <i class="fa fa-fw fa-globe"></i>掘金</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://segmentfault.com/u/kingxiaohai" target="_blank" title="SegmentFault">
                  
                    <i class="fa fa-fw fa-globe"></i>SegmentFault</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/19de76098ed1/timeline" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-globe"></i>简书</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">osenki</span>

  
</div>


  <div class="powered-by">
  <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
    本站访客数:<span id="busuanzi_value_site_uv"></span>
  </span>
  </div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
